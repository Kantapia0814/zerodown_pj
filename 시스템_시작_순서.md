# 🚀 Zero-Downtime 시스템 시작 순서

## ✅ **단계별 체크리스트**

### **1. Docker 켜기** ✅
```bash
# Docker Desktop 실행 후 완전히 로딩 대기
docker --version
docker ps
```

### **2. ⚠️ Consul 서버 먼저 켜기** (순서 중요!)
```bash
# 터미널 1 (Consul 전용)
consul agent -dev -bind=172.17.187.181 -client=0.0.0.0

# 확인
curl http://localhost:8500/v1/status/leader
```

### **3. Nomad 서버 켜기**
```bash
# 터미널 2 (Nomad 전용)
nomad agent -dev -bind=172.17.187.181

# 확인
nomad status
```

### **4. Nginx + Auto-reload 켜기** (중요한 추가!)
```bash
# Nginx 시작
sudo systemctl start nginx

# 터미널 3 (nginx-auto-reload 전용)
# 시스템에 설치된 스크립트 직접 실행
nginx-auto-reload.sh

# 또는 프로젝트 폴더에서 실행하려면:
# cd /mnt/c/Users/hongs/IdeaProjects/kantapia_pj
# chmod +x scripts/nginx-auto-reload.sh  
# ./scripts/nginx-auto-reload.sh
```

### **5. consul-template 실행** (중요!)
```bash
# 터미널 4 (consul-template 전용)
consul-template \
  -template="/etc/nginx/conf.d/hello-service.ctmpl:/etc/nginx/conf.d/hello-service.conf:echo 'Config updated'" \
  -consul-addr="127.0.0.1:8500" &
```

### **6. 서비스 배포하기 + 등록 대기**
```bash
# 터미널 5 (메인 작업용)
cd /mnt/c/Users/hongs/IdeaProjects/kantapia_pj

# Nomad 주소 설정 (중요!)
export NOMAD_ADDR="http://172.17.187.181:4646"

# 서비스 배포
nomad job run hello-service-dynamic.nomad

# 중요: 서비스 등록 대기 (30초-1분)
echo "서비스 등록 대기 중..."
sleep 30
```

### **7. 상태 확인 후 테스트**
```bash
# 상태 확인
./toggle_version_consul_true_zero_downtime.sh status

# API 테스트
curl http://localhost:8080/hello
curl http://localhost:8080/standby

# 부하 테스트 + switch/deploy 동시 테스트
k6 run k6-test.js &
./toggle_version_consul_true_zero_downtime.sh switch
```

---

## 🚨 **중요 포인트**

1. **순서 엄수**: Consul → Nomad → Nginx 순서 반드시 지키기
2. **대기 시간**: 각 단계마다 2-3분씩 안정화 대기
3. **터미널 관리**: 각 서비스별로 별도 터미널 사용
4. **IP 주소**: 172.17.187.181을 자신의 IP로 변경

## ✅ **완료 확인**

- [ ] Docker 실행됨
- [ ] Consul (localhost:8500) 응답
- [ ] Nomad (localhost:4646) 응답  
- [ ] nginx-auto-reload 실행중
- [ ] consul-template 실행중  
- [ ] hello-service 배포됨
- [ ] API (localhost:8080) 응답
- [ ] k6 테스트 통과

**🎯 모든 체크가 완료되면 Zero-Downtime 시스템 준비 완료!**